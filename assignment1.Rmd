---
title: "Assignment 1"
author: "Group 11"
date: "The Date"
output: pdf_document
---

\section{1. Problem Statement: PCA}
The file drugsrecovery.txt provides data on recovery status of patients after administration of different doses of two different drugs, L and R. The recovery status is measured as a percentage drop in body pathogens pre- and post-drug administration. A larger percentage drop implies better recovery. The administering of the drugs, at each of the dose levels, is assumed to not interfere with recovery levels for previous and/or subsequent dose(s).  100 participants took part in the study. Variables L500 to R4000, respectively refer to drug L at a dose level of 500 micrograms to drug R at 4000 micrograms. The ID is a patient’s hospital identification number. Perform a principal components analysis to:
    I. Determine the appropriate number of components that can be used to effectively summarize the information in the data. Explain how you settled on the reported number of components.
    II. If possible, provide an interpretation for the chosen sample principal components
    III. Comment on the (bi-)plot for the first two components


\section{2. Descriptive Statistics}

check missing values and impute (not needed here), take away ID column, check if all columns are int


```{r}
drugs <-read.delim("data/drugsrecovery.txt", header = TRUE, sep="",dec = ".")
sub_drugs <- subset(drugs, select = -c(ID)) 
sub_drugs <- data.frame(sub_drugs)
str(sub_drugs)

```
\section{2. Assumptions}

? scaling? 
princomp vs prcomp? 



The function princomp() uses the spectral decomposition approach.

The functions prcomp() and PCA()[FactoMineR] use the singular value decomposition (SVD).

According to R help, SVD has slightly better numerical accuracy. Therefore, prcomp() is the preferred function.




\section{3. Method}

PCA explained?
```{r}

pr.out <- prcomp(sub_drugs, scale = TRUE)
summary(pr.out)
```


- extract values based on different approaches:
extract P C 0 s to explain a given percentage of the variance
• scree plot: plot the eigenvalues in decreasing order and find the
elbow that distinguishes the mountain from the debris
• retain only P C 0 s with eigenvalue larger than one (only for standar-
dized data)
• Horn’s Parallel procedure: compute eigenvalues associated with
many simulated uncorrelated normal variables - retain the ith PC
if the corresponding eigenvalue is larger than the 95th percentile
of the distribution of the ith largest eigenvalue of the random
data (same idea as the previous rule but taking random variation
into account) 


```{r}
# Eigenvalues
eval <- pr.out$sdev^2
# First two eigenvalues are bigger than one
```


```{r}
# Eigenvectors
evec <- pr.out$rotation
```


```{r}
# Standard deviations and proportion of variance
summary(pr.out)
# First two principal components explain 69.34% of the variance
```



```{r}
# Scree Plot
par(mfrow = c(1,2))
plot(eval, xlab = "Principal Component", ylab = "Eigenvalue",
     type = "b", main = "Scree Plot")
```

```{r}
# Variance Explained Plot
prop_varex <- eval / sum(eval)
plot(prop_varex, xlab = "Principal Component", ylab = "Proportion of varianve explained",
     type = "b", main = "Variance Explained", ylim = c(0,1))
lines(cumsum(prop_varex), type = "b", lty = 3)
par(mfrow = c(1,1))
```


\section{4. Interpretation}

```{r}
# Correlation coefficients between PC's and initial variables
varnames <- names(drugs)[2:ncol(drugs)]
corrcoef <- matrix(nrow = 2, ncol = ncol(drugs)-1, byrow = T)
colnames(corrcoef) <- varnames
rownames(corrcoef) <- c("PC1", "PC2")

for( n in 1:length(rownames(corrcoef)) ){
  for( m in 1:nrow(evec) ){
    corrcoef[n,m] <- evec[m,n] * sqrt(eval)[n]
  }
}
corrcoef

# First principal component is significantly negatively correlated
# with all variables
# Second component discriminates between L2000, L4000, R2000, R4000 on one hand
# (high dose) and L500, L1000, R500 and R1000 on the other hand (low dose)
```


```{r}
biplot(pr.out)
biplot(pr.out, choices = c(3,4))

```

first plot shows two groupings of dosage amount independant of the drug

second plot barely shows any relevant information as there is barely any group seperation
-> was to be expected since they explain small portion of the variance only 

For the majority of the patients, both drugs had barely any effect on the percentage
drop. Lower dose seems to be more effective compared to higher dose, as with a lower
dose more patients had a percentage drop.


\section{1. Problem Statement Task 2:} 
exploratory factor analysis:
• explain the correlation structure among observed variables
• try to find underlying dimensions that can explain the observed
correlations
• example: the correlation between scores on mathematics, statis-
tics and physics exams can be explained because they all measure
somehow quantitative intelligence


1. State the problem

2. Descriptive Statistics (to check data, to find outliers)

3. Test (or at least state) the assumptions of the method, if any

4. Conduct the method (describe in more detail the "best" approach you have found)

5. Interpret the solution

6. Compare the results briefly with alternative solutions, if any

7. Conclusion


```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
```


\section{Descriptive Statistics}
```{r}
library(psych)

corr <-read.delim("data/screening.txt", header = TRUE, sep="",dec = ".", skipNul = FALSE)
corr <- subset(corr, select = -c(X_name_)) 

m <- matrix(NA,20,20)
m[lower.tri(m,diag=TRUE)] <- 1:10

makeSymm <- function(m) {
   m[upper.tri(m)] <- t(m)[upper.tri(m)]
   return(m)
}

corr <- makeSymm(corr)
```


\section{Assumptions of Methods}
assuming standardized data and factors + uncorrelated factors

```{r}
# Perform Kaiser's MSA to evaluate appropriateness of data
KMO(corr)
# Kaiser MSA = 0.95 > 0.8 --> appropriate data
```

\section{Method}

```{r}
# Define the amount of factors
eval <- eigen(corr)$values
plot(eval, xlab = "Principal Component", ylab = "Eigenvalue",
     type = "b", main = "Scree Plot")
# Choose 2 factors

# CHECK USING HORNS

# Perform Factor Analysis
fa.out <- fa(r = corr, nfactors = 2, rotate = "varimax")
fa.out

```


\section{5. Interpretation of Solution}

# RMSR = 0.04
# First factor represents: 1,2,4,8,9,10,11,12,13,15,16,18,19,20
# Second factor represents: 3,5,6,7,14,17
# First factor might be called "High intense anxiety"
# Second factor might be called "Low intense anxiety"


```{r}
# Plot of factor loadings
plot(fa.out, title = "Factor loadings")
```

```{r}
# Structural diagram
fa.diagram(fa.out, main = "Structural diagram")
```




